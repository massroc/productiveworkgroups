# Development Dockerfile for Elixir/Phoenix with hot reloading
FROM elixir:1.18-otp-27-slim

# Install build dependencies, Node.js, and Chrome for E2E tests
RUN apt-get update && apt-get install -y \
    build-essential \
    git \
    curl \
    inotify-tools \
    postgresql-client \
    # Chrome and chromedriver for Wallaby E2E tests
    chromium \
    chromium-driver \
    && curl -fsSL https://deb.nodesource.com/setup_22.x | bash - \
    && apt-get install -y nodejs \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Set Chrome path for Wallaby
ENV CHROME_PATH=/usr/bin/chromium

# Install hex and rebar
RUN mix local.hex --force && \
    mix local.rebar --force

# Set working directory
WORKDIR /app

# Set environment to development
ENV MIX_ENV=dev

# Expose Phoenix port
EXPOSE 4000

# Default command starts Phoenix server with live reload
CMD ["sh", "-c", "mix deps.get && mix ecto.setup && mix phx.server"]
